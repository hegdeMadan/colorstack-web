{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isComposable = undefined;\n\nvar _unset2 = require('lodash/unset');\n\nvar _unset3 = _interopRequireDefault(_unset2);\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _set2 = require('lodash/set');\n\nvar _set3 = _interopRequireDefault(_set2);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.default = queriesReducer;\n\nvar _immer = require('immer');\n\nvar _immer2 = _interopRequireDefault(_immer);\n\nvar _constants = require('../constants');\n\nvar _query = require('../utils/query');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar isComposable = exports.isComposable = function isComposable(action) {\n  return (0, _get3.default)(action, 'meta.where') && (0, _get3.default)(action, 'meta.collection');\n};\n\nfunction queriesReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments[1];\n  return (0, _immer2.default)(state, function (draft) {\n    if (!isComposable(action)) {\n      return state;\n    }\n\n    var key = (0, _query.getBaseQueryName)(action.meta);\n\n    switch (action.type) {\n      case _constants.actionTypes.GET_SUCCESS:\n      case _constants.actionTypes.LISTENER_RESPONSE:\n        draft[key] = _extends({\n          data: action.payload.data\n        }, action.meta);\n        return draft;\n\n      case _constants.actionTypes.UNSET_LISTENER:\n        if (draft[key]) {\n          draft[key].data = undefined;\n        }\n\n        return draft;\n\n      case _constants.actionTypes.DOCUMENT_ADDED:\n      case _constants.actionTypes.DOCUMENT_MODIFIED:\n        (0, _set3.default)(draft, [key, 'data', action.meta.doc], action.payload.data);\n        return draft;\n\n      case _constants.actionTypes.DOCUMENT_REMOVED:\n      case _constants.actionTypes.DELETE_SUCCESS:\n        (0, _unset3.default)(draft, [key, 'data', action.meta.doc]);\n        return draft;\n\n      default:\n        return state;\n    }\n  });\n}","map":null,"metadata":{},"sourceType":"script"}